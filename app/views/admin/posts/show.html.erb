<h1><%= @post.title %></h1>

<p><strong>Content:</strong> <%= @post.content %></p>

<p><strong>Author:</strong> <%= link_to @post.user.name, admin_user_path(@post.user) %></p>

<p><strong>Created At:</strong> <%= @post.created_at %></p>

<% if @post.image.attached? %>
  <%= image_tag @post.image, style: 'max-width: 300px; max-height: 300px;' %>
<% end %>

<h2>Comments</h2>
<% @post.comments.each do |comment| %>
  <div class="comment">
    <p>
      <strong><%= comment.user.name %>:</strong> 
      <%= comment.posted_text %>
    </p>
    <!-- Delete link -->
    <%= link_to "Delete", public_comment_path(@post, comment), method: :delete, data: { confirm: "Are you sure you want to delete this comment?" } %>
    <!-- Reply form -->
    <%= form_with(model: [comment, Comment.new], local: true) do |reply_form| %>
      <%= reply_form.hidden_field :post_id, value: @post.id %>
      <%= reply_form.hidden_field :user_id, value: current_user.id %>
      <%= reply_form.text_area :posted_text, placeholder: "Reply to #{comment.user.name}...", class: "form-control" %>
      <%= reply_form.submit "Reply", class: "btn btn-primary" %>
    <% end %>
    <!-- Replies -->
    <% comment.replies.each do |reply| %>
      <div class="reply">
        <p>
          <strong><%= reply.user.name %>:</strong> 
          <%= reply.posted_text %>
        </p>
        <!-- Delete reply link -->
        <%= link_to "Delete", public_comment_reply_path(@post, comment, reply), method: :delete, data: { confirm: "Are you sure you want to delete this reply?" } %>
      </div>
    <% end %>
  </div>
<% end %>

<%= button_to "Back", admin_posts_path, method: :get, class: "btn btn-secondary" %>
