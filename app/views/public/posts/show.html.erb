<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= @post.title %></title>

  <!-- スタイルの定義 -->
<style>
  @media (max-width: 600px) {
    .plate {
      width: 100%;
    }
    .home-box {
      padding: 0 10px;
    }
    .notification {
      margin: 10px 0;
    }
  }
  body {
    text-align: left; /* すべてのテキストを左揃えにする */
  }

  /* 投稿のタイトルや作成日時、投稿者などの要素のスタイル */
  h1, p, strong {
    margin-left: 0;
  }
  h5 {
    margin-left: 10px; 
  }
  form {
    margin-left: 10px;
  }
  /* 投稿内容のコンテナのスタイル */
  .post-container {
    max-width: 700px; /* 最大幅を設定 */
    text-align: left; 
    padding: 0 10px; 
  }

  /* コメント欄のスタイル */
  .comment-box {
    margin-top: 20px;
    margin-left: 0; 
  }
  .comment {
    border: 1px solid #ccc;
    border-radius: 5px;
    padding: 10px;
    margin-top: 10px;
    margin-left: 10px;
    padding: 0 10px; 
    max-width: calc( 700px ); 
    word-wrap: break-word; /* テキストがはみ出た場合に改行 */
  }
  .comment-author {
    font-weight: bold;
  }
  .own-comment {
    background-color: #f2f2f2; /* 自分のコメントの背景色 */
  }
  .like {
    margin-left: 10px; 
  }

  /* 画像ポップアップ用のスタイル */
  .popup-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7); /* オーバーレイの背景色 */
    z-index: 9999;
  }
  .popup-img {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    max-width: 90%;
    max-height: 90%;
    z-index: 10000;
  }
</style>

</head>
<body>
<!-- 投稿内容のコンテナ -->
<div class="post-container">
  <!-- 投稿のタイトル表示 -->
  <h1><%= @post.title %></h1>
  <!-- 投稿の作成日時表示 -->
  <p><strong>作成日時:</strong> <%= @post.created_at %></p>
  <!-- 投稿者名へのリンク -->
  <p><strong>投稿者:</strong> <%= link_to @post.user.name, public_user_path(@post.user) %></p>

  <!-- 投稿内容表示 -->
  <div class="post-content">
    <!-- 投稿された画像がある場合、画像をポップアップ表示 -->
  <% if @post.image.attached? %>
   <div style="max-width: 700px; margin: 0 auto; float: left; margin-right: 10px;">
    <%= link_to url_for(@post.image), target: "_blank" do %>
      <%= image_tag @post.image.variant(resize: "700x700"), class: "post-image", data: { original_image: url_for(@post.image) } %>
    <% end %>
   </div>
  <% end %>

    <!-- 投稿のテキスト表示 -->
    <div class="post-text">
      <p><strong>投稿文</strong></p>
      <%= @post.content %>
    </div>
  </div>
</div>

<!-- いいねボタン -->
<br><%= render 'likes/like_button', post: @post %>

<!-- フォローボタン -->
<%= render 'follows/follow', post: @post %><br>

<!-- コメント欄 -->
<h5>コメント</h5>
<div class="comment-box">
  <% @post.comments.each do |comment| %>
    <% if comment.user %>
      <!-- コメントの表示 -->
      <div class="comment <%= 'own-comment' if comment.user == @post.user %>">
        <!-- コメントの投稿者名表示 -->
        <span class="comment-author"><%= comment.user.name %>:</span>
        <!-- コメント内容表示 -->
        <span><%= comment.posted_text %></span>
        <!-- 自分のコメントまたは投稿者のコメントの場合、削除リンク表示 -->
        <% if comment.user == current_user || @post.user == current_user %>
          <%= link_to '削除', public_comment_path(comment), method: :delete, data: { confirm: '本当に削除しますか？' } %>
        <% end %>
      </div>
    <% end %>
  <% end %>
</div>

<!-- コメント投稿フォーム -->
<%= form_with(model: [@post, @post.comments.build], url: public_comments_path, local: true) do |form| %>
  <%= form.hidden_field :post_id, value: @post.id %>
  <div class="field">
    <%= form.text_area :posted_text, rows: 4 %>
  </div>
  <div class="actions">
    <%= form.submit "コメントする" %>
  </div>
<% end %>

<!-- 投稿削除リンク -->
<% if @post.user == current_user %>
<%= link_to '投稿を削除', public_post_path(@post), method: :delete, data: { confirm: '本当に削除しますか？' }, style: 'margin-left: 10px;' %>
<% end %>

<!-- 戻るボタン -->
<%= button_to '戻る', public_posts_path, method: :get, class: 'btn btn-secondary', style: 'margin-bottom: 20px;' %>
